<Window x:Class="OrderWatch.Views.TradeHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="交易历史记录" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <TextBlock Grid.Row="0" Text="交易历史记录" FontSize="20" FontWeight="Bold" 
                   Margin="0,0,0,20" Foreground="#2196F3"/>

        <!-- 查询条件 -->
        <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="1" 
                CornerRadius="5" Padding="15" Margin="0,0,0,15" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="开始日期:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <DatePicker Grid.Column="1" x:Name="StartDatePicker" SelectedDate="{Binding StartDate}" 
                           Width="120" Margin="0,0,15,0"/>

                <TextBlock Grid.Column="2" Text="结束日期:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <DatePicker Grid.Column="3" x:Name="EndDatePicker" SelectedDate="{Binding EndDate}" 
                           Width="120" Margin="0,0,15,0"/>

                <TextBlock Grid.Column="4" Text="合约:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox Grid.Column="5" Text="{Binding FilterSymbol, UpdateSourceTrigger=PropertyChanged}" 
                        Width="100" Margin="0,0,15,0" ToolTip="留空表示查询所有合约"/>

                <Button Grid.Column="6" Content="🔍 查询" Command="{Binding QueryCommand}" 
                       Width="80" Height="30" Background="#4CAF50" Foreground="White" 
                       FontWeight="Bold" Margin="0,0,0,0"/>
            </Grid>
        </Border>

        <!-- 历史记录列表 -->
        <DataGrid Grid.Row="2" x:Name="HistoryDataGrid" 
                  ItemsSource="{Binding TradeHistories}"
                  SelectedItem="{Binding SelectedTradeHistory}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  CanUserResizeRows="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  SelectionUnit="FullRow">
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="时间" Binding="{Binding FormattedTimestamp}" Width="150"/>
                <DataGridTextColumn Header="合约" Binding="{Binding Symbol}" Width="80"/>
                <DataGridTextColumn Header="操作" Binding="{Binding Action}" Width="120"/>
                <DataGridTextColumn Header="价格" Binding="{Binding FormattedPrice}" Width="80"/>
                <DataGridTextColumn Header="数量" Binding="{Binding FormattedQuantity}" Width="80"/>
                <DataGridTextColumn Header="结果" Binding="{Binding Result}" Width="60"/>
                <DataGridTextColumn Header="订单类型" Binding="{Binding FormattedOrderType}" Width="80"/>
                <DataGridTextColumn Header="方向" Binding="{Binding FormattedSide}" Width="60"/>
                <DataGridTextColumn Header="杠杆" Binding="{Binding FormattedLeverage}" Width="60"/>
                <DataGridTextColumn Header="分类" Binding="{Binding Category}" Width="80"/>
                <DataGridTextColumn Header="详情" Binding="{Binding Details}" Width="200"/>
            </DataGrid.Columns>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Result}" Value="成功">
                            <Setter Property="Background" Value="#E8F5E8"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Result}" Value="失败">
                            <Setter Property="Background" Value="#FFEBEE"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>

        <!-- 底部操作栏 -->
        <Border Grid.Row="3" BorderBrush="#E0E0E0" BorderThickness="1" 
                CornerRadius="5" Padding="15" Margin="0,15,0,0" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" VerticalAlignment="Center" 
                           Foreground="#666" FontStyle="Italic"/>

                <Button Grid.Column="1" Content="📊 导出CSV" Command="{Binding ExportCsvCommand}" 
                       Width="100" Height="30" Background="#FF9800" Foreground="White" 
                       FontWeight="Bold" Margin="0,0,10,0"/>

                <Button Grid.Column="2" Content="🔄 刷新" Command="{Binding RefreshCommand}" 
                       Width="80" Height="30" Background="#2196F3" Foreground="White" 
                       FontWeight="Bold" Margin="0,0,10,0"/>

                <Button Grid.Column="3" Content="❌ 关闭" Click="CloseButton_Click" 
                       Width="80" Height="30" Background="#F44336" Foreground="White" 
                       FontWeight="Bold"/>
            </Grid>
        </Border>
    </Grid>
</Window>
